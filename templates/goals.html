<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goals - Four Quadrants Task Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <a href="{{ url_for('index') }}" class="btn btn-icon">
                <i class="bi bi-arrow-left"></i>
            </a>
            <h1>Goals</h1>
            <button class="btn btn-primary" onclick="showAddGoalModal()">
                <i class="bi bi-plus"></i> Add Goal
            </button>
        </div>

        <div class="goals-container">
            <div id="goalsList">
                {% for goal in goals %}
                <div class="goal-card">
                    <div class="goal-header">
                        <div class="goal-icon">‚öõÔ∏è</div>
                        <h3>{{ goal.title }}</h3>
                        <div class="countdown" data-deadline="{{ goal.deadline }}"></div>
                    </div>
                    <div class="goal-objective">
                        <strong>üéØ Objective:</strong> {{ goal.objectives }}
                    </div>
                    <div class="goal-must-do">
                        <strong>üìå Must do:</strong> {{ goal.must_do }}
                    </div>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ goal.progress }}%" 
                             aria-valuenow="{{ goal.progress }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            {{ goal.progress }}%
                        </div>
                    </div>
                    <div class="review-section">
                        <div class="works-well">
                            <h4>‚úÖ What works (do more)</h4>
                            <p>{{ goal.works_well or 'No notes yet' }}</p>
                        </div>
                        <div class="needs-change">
                            <h4>‚ùå What doesn't work (needs to be changed)</h4>
                            <p>{{ goal.needs_change or 'No notes yet' }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div class="modal fade" id="addGoalModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Goal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addGoalForm" action="{{ url_for('add_goal') }}" method="POST">
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deadline</label>
                            <input type="date" class="form-control" name="deadline" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Objective</label>
                            <textarea class="form-control" name="objectives" rows="2" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Must Do</label>
                            <textarea class="form-control" name="must_do" rows="2" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="addGoalForm" class="btn btn-primary">Add Goal</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add this before the closing </body> tag -->
    <script>
        // Initialize Bootstrap components
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize modals
            var modals = document.querySelectorAll('.modal');
            modals.forEach(function(modal) {
                new bootstrap.Modal(modal);
            });
    
            // Initialize the countdown timer
            updateCountdowns();
            setInterval(updateCountdowns, 1000);
        });
    
        function showAddGoalModal() {
            const modal = new bootstrap.Modal(document.getElementById('addGoalModal'));
            modal.show();
        }
    
        function updateCountdowns() {
            document.querySelectorAll('.countdown').forEach(el => {
                const deadline = new Date(el.dataset.deadline);
                const now = new Date();
                const diff = deadline - now;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                el.textContent = `${days}d ${hours}h remaining`;
                el.classList.toggle('overdue', diff < 0);
            });
        }
    </script>
</body>
</html>